<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>开发项管理系统</title>
    <link rel="stylesheet" type="text/css" href="../../css/itemscss/items.css">
    <link rel="stylesheet" type="text/css" href="../../css/itemscss/single.css">
</head>
<script type="text/javascript" src="../../js/items/itemsFN.js"></script>
<body style="background-image: url(itemimages/items1.jpg); background-size:100%;">
    <div style="margin:10px;">
        <!-- 第一部分 -->
        <div class="firstBox">
            <h5>开发项明细：</h5>
            <button id="query">查询</button>
            <button id="button">新增</button>
            <button id="modify">修改</button>
            <button id="del">删除</button>
            <!-- 全选，全部取消选中 -->
            <label style="padding-left:20px;"><input name="chose" type="radio" value="1" onclick="setRowClass2(1)"/>全选</label> 
			<label style="padding-left:10px;"><input name="chose" type="radio" value="2" onclick="setRowClass2(2)"/>全部取消</label> 

            <button id="signout" style="margin-right:20px;float:right;background: #fff;border: 1px solid #fff;">退出登录</button>
            <table id="ttab">
                <thead>
                    <tr>
                    	<th style=text-align:center;width:2%;>序号</th>
                    	<th style="display:none;">ID主键</th>
                        <th style=text-align:center;width:10%;>开发项名称</th>
                        <th style=text-align:center;width:20%;>开发项描述</th>
                        <th style=text-align:center;width:6%;>开发责任人</th>
                        <th style=text-align:center;width:10%;>计划完成时间</th>
                        <th style=text-align:center;width:6%;>开发状态</th>
                        <th style=text-align:center;width:6%;>测试状态</th>
                        <th style=text-align:center;width:8%;>是否存在开发文档</th>
                        <th style=text-align:center;width:6%;>制单人</th>
                        <th style=text-align:center;width:15%;>制单日期</th>
                    </tr>
                </thead>
                <tbody id="tby">
                </tbody>
            </table>
        </div>
        <!-- 第二部分 -->
        <div id="twoBox" onmousedown="mouseDown(this,event)" onmousemove="mouseMove(event)" onmouseup="mouseUp(event)">
            <div class="twoBox_lever">
                <div class="twoBox_lever_two">
                    <div class="two_title">
                        <p>新增开发项</p>
                    </div>
                    <form>
                        <label style="float:left;"><span style="padding-right:16px;">开发项名称：</span>
                            <input type="text" id="add_item" autocomplete="off" placeholder="请输入内容">
                        </label>
                        <label style="float:left"><span style="padding-right:16px;">开发项描述：</span>
                            <input type="text" id="add_itemcomm" autocomplete="off" placeholder="请输入内容">
                        </label>
                        <label style="float:left"><span style="padding-right:16px;">开发责任人：</span>
                            <input type="text" id="add_itemdev" autocomplete="off" placeholder="请输入内容">
                        </label>
                        <label style="float:left">计划完成时间：
                        	<input type="date" id="add_plandate" autocomplete="off" placeholder="请输入内容">
                        </label><br>
                        <label style="float:left;width:50%;"><span style="padding-right:32px;">开发状态：</span>
                        	<select id="add_itemstatus" name="add_itemstatus" style="margin-left:5px;width:70px;" onchanged="" onchange="">
								<option value="待开发" checked="checked">待开发</option>
								<option value="开发中">开发中</option>
								<option value="已完成">已完成</option>
							</select>
							<!-- 
							<input type="text" id="add_itemstatus" autocomplete="off" placeholder="请输入内容">
							 -->
                        </label>
                        <label style="float:left"><span style="padding-right:32px;">测试状态：</span>
                        	<select id="add_itemteststatus" name="add_itemteststatus" style="margin-left:5px;width:70px;" onchanged="" onchange="">
								<option value="待测试" checked="checked">待测试</option>
								<option value="测试中">测试中</option>
								<option value="已关">已关闭</option>
							</select>
							<!-- 
							<input type="text" id="add_itemteststatus" autocomplete="off" placeholder="请输入内容">
							 -->
                        </label>
                        <label style="float:left;padding-top: 6px;"><span style="padding-right:32px;">开发文档：</span>
                        	<select id="add_itemdoc" name="add_itemdoc" style="margin-left:5px;width:70px;" onchanged="" onchange="">
								<option value="未编制" checked="checked">未编制</option>
								<option value="在编制">在编制</option>
								<option value="已完成">已完成</option>
								<option value="无">无</option>
							</select>
							<!-- 
							<input type="text" id="add_itemdoc" autocomplete="off" placeholder="请输入内容">
							 -->
                        </label>
                    </form>
                    <div class="two_footer">
                        <!-- <button>保存</button> -->
                        <button id="addok">保存</button>
                        <button id="addcancel">取消</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- 第三部分 -->
        <div id="thrBox" onmousedown="mouseDownM(this,event)" onmousemove="mouseMoveM(event)" onmouseup="mouseUpM(event)">
            <div class="thrBox_lever">
                <div class="thrBox_lever_two">
                    <div class="thr_title">
                        <p>开发项修改</p>
                    </div>
                    <form>
                        <label style="float:left">ID：
                            <input type="text" disabled="disabled" id="mod_itemid" placeholder="请输入内容">
                        </label>
                        <label style="float:left"><span style="padding-right:16px;">开发项名称：</span>
                            <input type="text" id="mod_item" autocomplete="off" placeholder="请输入内容">
                        </label>
                        <label style="float:left"><span style="padding-right:16px;">开发项描述：</span>
                            <input type="text" id="mod_itemcomm" autocomplete="off" placeholder="请输入内容">
                        </label>
                        <label style="float:left"><span style="padding-right:16px;">开发责任人：</span>
                            <input type="text" id="mod_itemdev" autocomplete="off" placeholder="请输入内容">
                        </label>
                        <label style="float:left">计划完成时间：
                            <input type="date" id="mod_plandate" autocomplete="off" placeholder="请输入内容">
                        </label>
                        <label style="float:left"><span style="padding-right:32px;">开发状态：</span>
                        	<select id="mod_itemstatus" name="mod_itemstatus" style="margin-left:5px;width:70px;" onchanged="" onchange="">
								<option value="待开发" checked="checked">待开发</option>
								<option value="开发中">开发中</option>
								<option value="已完成">已完成</option>
							</select>
							<!-- 
							<input type="text" id="mod_itemstatus" autocomplete="off" placeholder="请输入内容">
							 -->
                        </label>
                        <label style="float:left"><span style="padding-right:10px;padding-left:10px;">测试状态：</span>
                        	<select id="mod_itemteststatus" name="mod_itemteststatus" style="margin-left:5px;width:70px;" onchanged="" onchange="">
								<option value="待测试" checked="checked">待测试</option>
								<option value="测试中">测试中</option>
								<option value="已关闭">已关闭</option>
							</select>
							<!-- 
							<input type="text" id="mod_itemteststatus" autocomplete="off" placeholder="请输入内容">
							 -->
                        </label>
                        <label style="float:left;padding-top: 6px;"><span style="padding-right:32px;">开发文档：</span>
                        	<select id="mod_itemdoc" name="mod_itemdoc" style="margin-left:5px;width:70px;" onchanged="" onchange="">
								<option value="未编制" checked="checked">未编制</option>
								<option value="在编制">在编制</option>
								<option value="已完成">已完成</option>
								<option value="无">无</option>
							</select>
							<!-- 
							<input type="text" id="mod_itemdoc" autocomplete="off" placeholder="请输入内容">
							 -->
                        </label>
                    </form>
                    <div class="thr_footer">
                        <!-- <button>保存</button> -->
                        <button id="modok">保存</button>
                        <button id="modcancel">取消</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- 第四部分  查询条件框 -->
        <div id="forBox" onmousedown="mouseDownM(this,event)" onmousemove="mouseMoveM(event)" onmouseup="mouseUpM(event)">
            <div class="forBox_lever">
                <div class="forBox_lever_two">
                    <div class="for_title">
                        <p>查询</p>
                    </div>
                    <div class="thr_footer">
                        <button id="findok">查询</button>
                        <button id="findcancel">关闭</button>
                    </div>
                    <form>
                        <label style="float:left">开发项名称：
                            <input type="text" id="find_item" autocomplete="off" placeholder="请输入内容">
                        </label>
                        <label style="float:left">开发项描述：
                            <input type="text" id="find_itemcomm" autocomplete="off" placeholder="请输入内容">
                        </label>
                        <label style="float:left">开发责任人：
                            <input type="text" id="find_itemdev" autocomplete="off" placeholder="请输入内容">
                        </label>
                        <label style="float:left;padding-top:3px;"><span style="padding-right:16px;">开发状态：</span>
                        	<select id="find_itemstatus" name="find_itemstatus" style="margin-left:5px;width:70px;" onchanged="" onchange="">
                        		<option value=""></option>
								<option value="待开发">待开发</option>
								<option value="开发中">开发中</option>
								<option value="已完成">已完成</option>
							</select>
							<!-- 
							<input type="text" id="mod_itemstatus" autocomplete="off" placeholder="请输入内容">
							 -->
                        </label>
                        <label style="float:left;padding-top:3px;"><span style="padding-right:10px;padding-left:10px;">测试状态：</span>
                        	<select id="find_itemteststatus" name="find_itemteststatus" style="margin-left:5px;width:70px;" onchanged="" onchange="">
                        		<option value=""></option>
								<option value="待测试">待测试</option>
								<option value="测试中">测试中</option>
								<option value="已关闭">已关闭</option>
							</select>
							<!-- 
							<input type="text" id="mod_itemteststatus" autocomplete="off" placeholder="请输入内容">
							 -->
                        </label>
                    </form>
                </div>
            </div>
        </div>
    </div>
</body>
<script type="text/javascript" src="../../js/items/itemsFN.js"></script>
<script type="text/javascript" src="../../js/items/toolFN.js"></script>
<script>
    window.onload = function () {
    	setNow();//设置全局时间框为当前时间 YYYY-mm-dd
    	//登冲击按钮监控
    	document.getElementById("signout").onclick = function(){
    		signout();
    	}
    	document.getElementsByName("input[name=chose]").change = function(){
    		alert(1);
    	}
    	//打开查询窗口
        document.getElementById("query").onclick = function () {
            document.getElementById("forBox").classList.add("show");
        }
        //关闭查询窗口
        document.getElementById("findcancel").onclick = function () {
            document.getElementById("forBox").classList.remove("show");
        }
        //查询按钮
        document.getElementById("findok").onclick = function () {
        	//查询数据
        	var findItem = document.getElementById("find_item").value;
        	var findItemcomm = document.getElementById("find_itemcomm").value;
        	var findItemdev = document.getElementById("find_itemdev").value;
        	var findItemstatus = document.getElementById("find_itemstatus")[document.getElementById("find_itemstatus").selectedIndex].value;
        	var findItemteststatus = document.getElementById("find_itemteststatus")[document.getElementById("find_itemteststatus").selectedIndex].value;
        	var params = {findItem:findItem,findItemcomm:findItemcomm,findItemdev:findItemdev,
        					findItemstatus:findItemstatus,findItemteststatus:findItemteststatus}
        	loadData(params);
            document.getElementById("forBox").classList.remove("show");
        }
        document.getElementById("button").onclick = function () {
            document.getElementById("twoBox").classList.add("show");
        }
        
        document.getElementById("addcancel").onclick = function () {
            document.getElementById("twoBox").classList.remove("show");
        }
        //弹出修改之前，需要进行查询
        document.getElementById("modify").onclick = function () {
        	var tbl = document.getElementById("ttab");
        	var con = false, count = 0, index=0;
	    	for(var i=0;i<tbl.rows.length; i++){
	    		if(tbl.rows[i].classList.contains("checked")){
	    			con = true;
	    			count++;
	    			index = i;
	    		}
	    	}
	    	if(!con){
	    		alert('请选中要修改的数据');
	    		return false;
	    	}
	    	if(count>1){
	    		alert('请选中一条数据进行修改');
	    		return false;
	    	}
	    	//填充数据
	    	document.getElementById("mod_itemid").value=document.getElementsByTagName("tr")[index].getElementsByTagName("td")[1].innerText;
	    	document.getElementById("mod_item").value=document.getElementsByTagName("tr")[index].getElementsByTagName("td")[2].innerText;
	    	document.getElementById("mod_itemcomm").value=document.getElementsByTagName("tr")[index].getElementsByTagName("td")[3].innerText;
	    	document.getElementById("mod_itemdev").value=document.getElementsByTagName("tr")[index].getElementsByTagName("td")[4].innerText;
	    	document.getElementById("mod_plandate").value=document.getElementsByTagName("tr")[index].getElementsByTagName("td")[5].innerText;
	    	document.getElementById("mod_itemstatus").value=document.getElementsByTagName("tr")[index].getElementsByTagName("td")[6].innerText;
	    	document.getElementById("mod_itemteststatus").value=document.getElementsByTagName("tr")[index].getElementsByTagName("td")[7].innerText;
	    	document.getElementById("mod_itemdoc").value=document.getElementsByTagName("tr")[index].getElementsByTagName("td")[8].innerText;
            document.getElementById("thrBox").classList.add("show");
        }
        document.getElementById("modcancel").onclick = function () {
            document.getElementById("thrBox").classList.remove("show");
        }
        //新增保存
        document.getElementById("addok").onclick = function () {
        	//获取输入数据
        	var item_name = document.getElementById("add_item").value;
        	var item_comm = document.getElementById("add_itemcomm").value;
        	var item_dev = document.getElementById("add_itemdev").value;
        	var item_plandate = document.getElementById("add_plandate").value;
        	//var item_status = document.getElementById("add_itemstatus").value;
        	//var item_status = document.getElementById("add_itemstatus").selectedIndex
			var item_status = document.getElementById("add_itemstatus")[document.getElementById("add_itemstatus").selectedIndex].value;
        	//var item_teststatus = document.getElementById("add_itemteststatus").value;
        	var item_teststatus = document.getElementById("add_itemteststatus")[document.getElementById("add_itemteststatus").selectedIndex].value;
        	//var item_doc = document.getElementById("add_itemdoc").value;
        	var item_doc = document.getElementById("add_itemdoc")[document.getElementById("add_itemdoc").selectedIndex].value;
        	if(item_name==null || item_name==""){
        		alert("开发项名称不能为空");
        		return false;
        	}
        	if(item_comm==null || item_comm==""){
        		alert("开发项描述不能为空");
        		return false;
        	}
        	if(item_dev==null || item_dev==""){
        		alert("开发项负责人不能为空");
        		return false;
        	}
        	var data = {item_name:item_name,item_comm:item_comm,item_dev:item_dev,item_plandate:item_plandate,
        	item_status:item_status,item_teststatus:item_teststatus,item_doc:item_doc};
			MAjax('POST', 'add', data, function(data){
				var obj = eval("("+data+")");
				if(obj.success){
					//alert(obj.msg);
					loadData();
				}else{
					alert(obj.msg);
				};
			}, function(error){alert(error)});
            document.getElementById("twoBox").classList.remove("show");
        }
        //修改保存
        document.getElementById("modok").onclick = function () {
        	//获取输入数据
        	debugger;
        	var id = document.getElementById("mod_itemid").value;
        	var item_name = document.getElementById("mod_item").value;
        	var item_comm = document.getElementById("mod_itemcomm").value;
        	var item_dev = document.getElementById("mod_itemdev").value;
        	var item_plandate = document.getElementById("mod_plandate").value;
        	var item_itemstatus = document.getElementById("mod_itemstatus")[document.getElementById("mod_itemstatus").selectedIndex].value;
        	var item_itemteststatus = document.getElementById("mod_itemteststatus")[document.getElementById("mod_itemteststatus").selectedIndex].value;
        	var item_itemdoc = document.getElementById("mod_itemdoc")[document.getElementById("mod_itemdoc").selectedIndex].value;
        	//var item_itemstatus = document.getElementById("mod_itemstatus").value;
        	//var item_itemteststatus = document.getElementById("mod_itemteststatus").value;
        	//var item_itemdoc = document.getElementById("mod_itemdoc").value;
        	if(item_name==null || item_name==""){
        		alert("开发项名称不能为空");
        		return false;
        	}
        	if(item_comm==null || item_comm==""){
        		alert("开发项描述不能为空");
        		return false;
        	}
        	if(item_dev==null || item_dev==""){
        		alert("开发项负责人不能为空");
        		return false;
        	}
        	if(item_plandate==null || item_plandate==""){
        		alert("计划完成时间不能为空");
        		return false;
        	}
        	if(item_itemstatus==null || item_itemstatus==""){
        		alert("开发状态不能为空");
        		return false;
        	}
        	if(item_itemteststatus==null || item_itemteststatus==""){
        		alert("测试状态不能为空");
        		return false;
        	}
        	if(item_itemdoc==null || item_itemdoc==""){
        		alert("开发文档状态不能为空");
        		return false;
        	}
        	var data = {id:id,item_name:item_name,item_comm:item_comm,item_dev:item_dev,
			        	item_plandate:item_plandate,item_status:item_itemstatus,
			        	item_teststatus:item_itemteststatus,item_doc:item_itemdoc};
			MAjax('POST', 'add', data, function(data){
				var obj = eval("("+data+")");
				if(obj.success){
					//alert(obj.msg);
					loadData();
				}else{
					alert(obj.msg);
				};
			}, function(error){alert(error)});
            document.getElementById("thrBox").classList.remove("show");
        }
        //删除数据
        document.getElementById("del").onclick = function () {
        	var r = confirm("确认删除选中的数据？");
			if (r == true) {
			    var tbl = document.getElementById("ttab");
	        	var con = false, index=0;
	        	var ids = "";
		    	for(var i=0;i<tbl.rows.length; i++){
		    		if(tbl.rows[i].classList.contains("checked")){
		    			con = true;
		    			index = i;
		    			ids += document.getElementsByTagName("tr")[index].getElementsByTagName("td")[1].innerText+",";
		    		}
		    	}
		    	if(!con){
		    		alert('请选中要删除的数据');
		    		return false;
		    	}
	        	//获取输入数据
	        	var data = {ids:ids.substr(0,ids.length-1)};
				MAjax('POST', 'delItem', data, function(data){
					var obj = eval("("+data+")");
					debugger;
					if(obj.success){
						loadData();
					}else{
						alert(obj.msg);
					};
				}, function(error){alert(error)});
	            document.getElementById("thrBox").classList.remove("show");
			}
        }
    }
    //加载数据
    loadData();
</script>
</html>